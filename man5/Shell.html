<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Shell(5) - SerenityOS man pages</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<img src="/banner.png" style="display: block; margin-left: auto; margin-right: auto; margin-bottom: 2em;">
<header id="title-block-header">
<h1 class="title">Shell(5) - SerenityOS man pages</h1>
</header>
<h2 id="name"><a style="margin-right: 15px" href="#name">#</a>Name</h2>
<p>The Shell Command Language</p>
<h2 id="introduction"><a style="margin-right: 15px" href="#introduction">#</a>Introduction</h2>
<p>The shell operates according to the following general steps:</p>
<ul>
<li>Some string is read from a source, be it a file, the standard input, or a command string (see <a href="/man1/Shell.html"><code>Shell</code>(1)</a>)</li>
<li>The shell parses the input to an abstract syntax tree</li>
<li>The shell performs various expansions and/or resolutions on the nodes</li>
<li>The shell performs various type checks and syntactic checks</li>
<li>The shell interprets the AST, evaluating commands as needed</li>
<li>For each given command, the shell flattens all the string/list arguments</li>
<li>For each given command, the shell records the applicable redirections</li>
<li>Should a command be executed, the shell applies the redirections, and executes the command with the flattened argument list</li>
<li>Should a command need waiting, the shell shall wait for the command to finish, and continue execution</li>
</ul>
<p>Any text below is superseded by the formal grammar defined in the <em>formal grammar</em> section.</p>
<h2 id="general-token-recognition"><a style="margin-right: 15px" href="#general-token-recognition">#</a>General Token Recognition</h2>
<p>This section describes the general tokens the language accepts, it should be noted that due to nature of the language, some tokens are valid only in a specific context.</p>
<h5 id="bareword"><a style="margin-right: 15px" href="#bareword">#</a>Bareword</h5>
<p>String of characters that are not <em>Special</em> or <em>Syntactic Elements</em></p>
<h5 id="glob"><a style="margin-right: 15px" href="#glob">#</a>Glob</h5>
<p>String of characters containing at least one of <code>*?</code> in <em>bareword</em> position</p>
<h5 id="history-events"><a style="margin-right: 15px" href="#history-events">#</a>History Events</h5>
<p>A <em>designator</em> starting with <code>!</code> in <em>bareword</em> position that describes a word or a range of words from a previously entered command. Please look at the section named 'History Event Designators' for a more thorough explanation. Only allowed in interactive mode.</p>
<h5 id="single-quoted-string"><a style="margin-right: 15px" href="#single-quoted-string">#</a>Single Quoted String</h5>
<p>Any sequence of characters between two single quotes (<code>'</code>)</p>
<h5 id="double-quoted-string"><a style="margin-right: 15px" href="#double-quoted-string">#</a>Double Quoted String</h5>
<p>Any sequence of <em>Double Quoted String Part</em> tokens:</p>
<ul>
<li>Barewords</li>
<li>Single Quotes</li>
<li>Variable References</li>
<li>History Events</li>
<li>Evaluate expressions</li>
<li>Escaped sequences</li>
</ul>
<h5 id="heredocs"><a style="margin-right: 15px" href="#heredocs">#</a>Heredocs</h5>
<p>Heredocs are made in two parts, the <em>initiator</em> and the <em>contents</em>, the <em>initiator</em> may be used in place of a string (i.e. wherever a string is allowed to be used), with the constraint that the <em>contents</em> must follow the <em>sequence</em> that the <em>initiator</em> is used in.</p>
<p>There are four different <em>initiators</em>:</p>
<ul>
<li><code>&lt;&lt;-token</code>: The <em>contents</em> may contain interpolations, and are terminated with a line containing only whitespace and then <em>token</em></li>
<li><code>&lt;&lt;-'token'</code>: The <em>contents</em> may <em>not</em> contain interpolations, but otherwise is the same as <code>&lt;&lt;-token</code></li>
<li><code>&lt;&lt;~token</code>: Similar to <code>&lt;&lt;-token</code>, but the starting whitespace of the lines in the <em>contents</em> is stripped, note that this happens after any and all expansions/interpolations are done.</li>
<li><code>&lt;&lt;~'token'</code>: Dedents (i.e. strips the initial whitespace) like <code>&lt;&lt;~token</code>, and disallows interpolations like <code>&lt;&lt;-'token'</code>.</li>
</ul>
<p>Note that heredocs <em>must</em> be listed in the same order as they are used after a sequence that has been terminated with a newline.</p>
<h5 id="variable-reference"><a style="margin-right: 15px" href="#variable-reference">#</a>Variable Reference</h5>
<p>Any sequence of <em>Identifier</em> characters, or a <em>Special Variable</em> following a <code>$</code>. Variables may be followed by a <em>Slice</em> (see <a href="#slice">Slice</a>)</p>
<h5 id="slice"><a style="margin-right: 15px" href="#slice">#</a>Slice</h5>
<p>Variables may be sliced into, which will allow the user to select a subset of entries in the contents of the variable. An expression of the form $<em>identifier</em>[<em>slice-contents</em>] can be used to slice into a variable, where <em>slice-contents</em> has semantics similar to <em>Brace Expansions</em>, but it may only evaluate to numeric values, that are used to index into the variable being sliced. Negative indices are allowed, and will index the contents from the end. It should be noted that the shell will always perform bounds-checking on the indices, and raise an error on out-of-bound accesses. Slices can slice into both lists and strings.</p>
<p>For example, <code>$lst[1..-2]</code> can be used to select a permutation of a 4-element list referred to by the variable <code>lst</code>, as the slice will evaluate to the list <code>(1 0 -1 -2)</code>, which will select the indices 1, 0, 3, 2 (in that order).</p>
<h5 id="immediate-expressions"><a style="margin-right: 15px" href="#immediate-expressions">#</a>Immediate Expressions</h5>
<p>An expression of the form '${identifier expression...}', such expressions are expanded to other kinds of nodes before resolution, and are internal functions provided by the shell. Currently, the following functions are exposed:</p>
<ul>
<li><p>${length (string|list)? <em>expression</em>} Finds the length of the given <em>expression</em>. if either <code>string</code> or <code>list</code> is given, the shell will attempt to treat <em>expression</em> as that type, otherwise the type of <em>expression</em> will be inferred.</p></li>
<li><p>${length<em>across (string|list) _expression</em>} Finds the lengths of the entries in <em>expression</em>, this requires <em>expression</em> to be a list. If either <code>string</code> or <code>list</code> is given, the shell attempts to treat the elements of <em>expression</em> as that type, otherwise the types are individually inferred.</p></li>
<li><p>${split <em>delimiter</em> <em>string</em>} Splits the <em>string</em> with <em>delimiter</em>, and evaluates to a list. Both <em>string</em> and <em>delimiter</em> must be strings.</p></li>
<li><p>${remove<em>suffix _suffix</em> <em>string</em>} Removes the suffix <em>suffix</em> (if present) from the given <em>string</em>.</p></li>
<li><p>${remove<em>prefix _prefix</em> <em>string</em>} Removes the prefix <em>prefix</em> (if present) from the given <em>string</em>.</p></li>
<li><p>${concat<em>lists _list</em>...} Concatenates all the given expressions as lists, and evaluates to a list.</p></li>
<li><p>${regex<em>replace _pattern</em> <em>replacement-template</em> <em>string</em>} Replaces all occurrences of the regular expression <em>pattern</em> in the given <em>string</em>, using the given <em>replacement-template</em>. Capture groups in <em>pattern</em> can be referred to as <code>\&lt;group_number&gt;</code> in the <em>replacement template</em>, for example, to reference capture group 1, use <code>\1</code>.</p></li>
</ul>
<h5 id="evaluate-expression"><a style="margin-right: 15px" href="#evaluate-expression">#</a>Evaluate expression</h5>
<p>Any expression following a <code>$</code> that is not a variable reference:</p>
<ul>
<li>Inline execution: A <em>syntactic list</em> following a <code>$</code>:</li>
<li>Dynamic evaluation: Any other expression following a <code>$</code></li>
</ul>
<h5 id="lists"><a style="margin-right: 15px" href="#lists">#</a>Lists</h5>
<p>Any two expressions joined by the Join operator (<code> </code> [whitespace]), or a <em>variable reference</em> referring to a list value</p>
<ul>
<li>Syntactic Lists: Any <em>list</em> enclosed in parentheses (<code>(</code> and <code>)</code>)</li>
</ul>
<h5 id="comments"><a style="margin-right: 15px" href="#comments">#</a>Comments</h5>
<p>Any text following and including that in a word starting with <code>#</code>, up to but not including a newline</p>
<h5 id="keywords"><a style="margin-right: 15px" href="#keywords">#</a>Keywords</h5>
<p>The following tokens:</p>
<ul>
<li><code>for</code> in command name position</li>
<li><code>in</code> as a syntactic element of a <code>for</code> expression</li>
<li><code>if</code> in command name position, or after the <code>else</code> keyword</li>
<li><code>else</code> after a partial <code>if</code> expression</li>
<li><code>match</code> in command name position</li>
<li><code>as</code> as part of a <code>match</code> expression</li>
</ul>
<h5 id="special-characters"><a style="margin-right: 15px" href="#special-characters">#</a>Special characters</h5>
<p>Any of the following:</p>
<ul>
<li><code>;</code> in bareword position</li>
<li><code>\\n</code> (a newline) in <em>bareword</em> position</li>
<li>Any of <code>(){}</code></li>
<li>Any of <code>*?</code> not in <em>glob</em> position</li>
</ul>
<h5 id="tilde"><a style="margin-right: 15px" href="#tilde">#</a>Tilde</h5>
<p>Any initial path segment starting with the character <code>~</code> in <em>bareword</em> position, Optionally followed by a <em>bareword</em> for the username</p>
<h2 id="redirections"><a style="margin-right: 15px" href="#redirections">#</a>Redirections</h2>
<p>The shell can create various redirections to file descriptors of a command before executing it, the general syntax for redirections is an optional file descriptor, followed by a redirection operator, followed by a destination.</p>
<p>There are four redirection operators corresponding to various file descriptor open modes: <code>Read</code>, <code>Write</code>, <code>WriteAppend</code> and <code>ReadWrite</code>, respectively <code>&lt;</code>, <code>&gt;</code>, <code>&gt;&gt;</code> and <code>&lt;&gt;</code>.</p>
<p>A special syntactic element <code>&amp;fd</code> can reference a file descriptor as a destination.</p>
<p>Redirections take two main forms, Read/Write redirections, and fd closure redirections.</p>
<h5 id="readwrite"><a style="margin-right: 15px" href="#readwrite">#</a>Read/Write</h5>
<ul>
<li>Allowed operators: all</li>
<li>Allowed destinations: file paths (any shell <em>expression</em>) and <em>file descriptor references</em></li>
</ul>
<h5 id="close"><a style="margin-right: 15px" href="#close">#</a>Close</h5>
<ul>
<li>Allowed operators: <code>Write</code> (<code>&gt;</code>)</li>
<li>Allowed destinations: the special "close" reference <code>&amp;-</code></li>
</ul>
<h4 id="examples"><a style="margin-right: 15px" href="#examples">#</a>Examples</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Redirect the standard error to a file, and close the standard input</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="dv">2</span><span class="op">&gt;</span> foo <span class="dv">1</span><span class="op">&gt;&amp;</span>-</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Redirect a file as read-write into the standard input</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="dv">1</span><span class="op">&lt;&gt;</span>foo</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Redirect the standard output to /dev/null</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="op">&gt;</span>/dev/null</span></code></pre></div>
<h2 id="expansions"><a style="margin-right: 15px" href="#expansions">#</a>Expansions</h2>
<p>The shell performs various expansions, in different stages.</p>
<ul>
<li><p>Glob Expansion: Globs shall be expanded to a list.</p></li>
<li><p>Variable Expansion: Variables shall be expanded preserving their types.</p></li>
<li><p>Brace Expansions: Brace expansions shall be expanded to a list.</p></li>
<li><p>Juxtaposition Expansion: Juxtapositions shall be expanded as list products.</p></li>
<li><p>Other expansions: Tildes, Evaluate expressions, etc. shall be expanded as needed.</p></li>
</ul>
<h3 id="brace-expansions"><a style="margin-right: 15px" href="#brace-expansions">#</a>Brace Expansions</h3>
<p>Brace expansions are of two kinds, <em>normal brace expansions</em> and <em>range brace expansions</em>. <em>Normal brace expansions</em> are sequences of optional expressions inside braces (<code>{}</code>), delimited by a comma (<code>','</code>); a missing expression is treated as an empty string literal. Such expressions are simply expanded to the expressions they enclose. <em>Range brace expansions</em> are of the form <code>{start_expression..end_expression}</code>, where <code>start_expression</code> and <code>end_expression</code> denote the bounds of an inclusive <em>range</em>, and can be one of two types:</p>
<ul>
<li>Single unicode code points: The range expands to all code points between the start and end, e.g. <code>{a..c}</code> shall expand to the list <code>(a b c)</code>.</li>
<li>Numbers: The range expands to all numbers between the start and end, e.g. <code>{8..11}</code> shall expand to the list <code>(8 9 10 11)</code>.</li>
</ul>
<h3 id="juxtapositions"><a style="margin-right: 15px" href="#juxtapositions">#</a>Juxtapositions</h3>
<p>Any two expressions joined without any operator are considered to be in a Juxtaposition, with the resulting value being the list product of two expressions. For instance, <code>(1 2)(3 4)</code> shall be evaluated to <code>(13 14 23 24)</code> by calculating the list product of the two expressions <code>(1 2)</code> and <code>(3 4)</code>.</p>
<h3 id="tildes"><a style="margin-right: 15px" href="#tildes">#</a>Tildes</h3>
<p>Any bareword starting with a tilde (<code>~</code>) and spanning up to the first path separator (<code>/</code>) - or EOL - is considered to be a tilde expansion with the text between the tilde and the separator being the <em>username</em>, which shall be expanded to a single string containing the home directory of the given <em>username</em> (or the current user if no username is provided).</p>
<h3 id="evaluate"><a style="margin-right: 15px" href="#evaluate">#</a>Evaluate</h3>
<p>Evaluate expressions take the general form of a dollar sign (<code>$</code>) followed by some <em>expression</em>, which is evaluated by the rules below.</p>
<ul>
<li>Should the <em>expression</em> be a string, it shall be evaluated as a dynamic variable lookup by first evaluating the string, and then looking up the given variable.</li>
<li>Should the <em>expression</em> be a list or a command, it shall be converted to a command, whose output (from the standard output) shall be captured, and split to a list with the shell local variable <code>IFS</code> (or the default splitter <code>\n</code> (newline, 0x0a)). It should be noted that the shell option <code>inline_exec_keep_empty_segments</code> will determine whether empty segments in the split list shall be preserved when this expression is evaluated, this behavior is disabled by default.</li>
</ul>
<h2 id="commands"><a style="margin-right: 15px" href="#commands">#</a>Commands</h2>
<p>A <code>Command</code> is a single simple command, containing arguments and redirections for a single program, or a compound command containing a shell control structure. The shell can evaluate a sequence of commands, a conditional relation between commands, or various semantic elements composed of commands and intrinsics.</p>
<p>Commands can be either calls to Shell builtins, or external programs.</p>
<h2 id="shell-semantic-elements"><a style="margin-right: 15px" href="#shell-semantic-elements">#</a>Shell Semantic Elements</h2>
<p>The commands can be composed into semantic elements, producing composite commands:</p>
<h3 id="sequences"><a style="margin-right: 15px" href="#sequences">#</a>Sequences</h3>
<p>A sequence of commands, executed serially independent of each other: <code>Command ; Command ; Command ...</code></p>
<p>It should be noted that a newline (<code>\\n</code>) can be substituted for the semicolon (<code>;</code>).</p>
<h4 id="example"><a style="margin-right: 15px" href="#example">#</a>Example</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do one thing, then do another</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> foo<span class="kw">;</span> <span class="bu">echo</span> bar</span></code></pre></div>
<h3 id="logical-relations"><a style="margin-right: 15px" href="#logical-relations">#</a>Logical Relations</h3>
<p>A sequence of commands whose execution depends somehow on the result of another</p>
<h4 id="command--command--command--and"><a style="margin-right: 15px" href="#command--command--command--and">#</a><code>Command &amp;&amp; Command &amp;&amp; Command ...</code> (AND)</h4>
<p>Short-circuiting command evaluations, will cancel the entire chain should any command fails (have a non-zero exit code)</p>
<h4 id="command--command--command--or"><a style="margin-right: 15px" href="#command--command--command--or">#</a><code>Command || Command || Command ...</code> (OR)</h4>
<p>Short-circuiting command evaluation, will continue down the chain if any command fails.</p>
<p>It should be noted that <code>And</code> chains bind more tightly than <code>Or</code> chains, so an expression of the form <code>C1 &amp;&amp; C2 || C3</code> is understood as "evaluate <code>C1</code>, if successful, evaluate <code>C2</code>, if not successful, evaluate <code>C3</code>".</p>
<h5 id="examples-1"><a style="margin-right: 15px" href="#examples-1">#</a>Examples</h5>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create file if not found</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">test</span> <span class="at">-f</span> foo.txt <span class="kw">||</span> <span class="fu">touch</span> foo.txt</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Announce execution status of a command</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> test <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;deleted!&quot;</span> <span class="kw">||</span> <span class="bu">echo</span> <span class="st">&quot;failed with </span><span class="va">$?</span><span class="st">&quot;</span></span></code></pre></div>
<h4 id="control-structures"><a style="margin-right: 15px" href="#control-structures">#</a>Control Structures</h4>
<h5 id="conditionals"><a style="margin-right: 15px" href="#conditionals">#</a>Conditionals</h5>
<p>Conditionals can either be expressed with the <em>Logical Relations</em>, or via explicit <code>if</code> expressions. An <code>if</code> expression contains at least a <em>condition</em> command and a <em>then clause</em>, and optionally the <code>else</code> keyword followed by an <em>else clause</em>. An <em>else clause</em> may contain another <code>if</code> expression instead of a normal block.</p>
<p>The <em>then clause</em> <strong>must</strong> be surrounded by braces, but the <em>else clause</em> may also be another <code>if</code> expression.</p>
<p>An <code>if</code> expression evaluates either the <em>then clause</em> or (if available) the <em>else clause</em>, based on the exit code of the <em>condition</em> command; should the exit code be zero, the <em>then clause</em> will be executed, and if not, the <em>else clause</em> will.</p>
<h6 id="examples-2"><a style="margin-right: 15px" href="#examples-2">#</a>Examples</h6>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove a file if it exists, create it otherwise</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">test</span> <span class="at">-e</span> the_file {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> the_file</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="er">}</span> <span class="cf">else</span> <span class="kw">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">touch</span> the_file</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Cond chain (if-elseif-else)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">A</span> {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> A</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="er">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="ex">B</span> {</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> B</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="er">}</span> <span class="cf">else</span> <span class="kw">{</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> C</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h5 id="for-loops"><a style="margin-right: 15px" href="#for-loops">#</a>For Loops</h5>
<p>For Loops evaluate a sequence of commands once per element in a given list. The shell has two forms of <em>for loops</em>, one with an explicitly named iteration variable, and one with an implicitly named one. The general syntax follows the form <code>for index index_name name in expr { sequence }</code>, and allows omitting the <code>index index_name name in</code> part to implicitly name the variable <code>it</code>.</p>
<p>It should be noted that the <code>index index_name</code> section is optional, but if supplied, will require an explicit iteration variable as well. In other words, <code>for index i in foo</code> is not valid syntax.</p>
<p>A for-loop evaluates the <em>sequence</em> once per every element in the <em>expr</em>, setting the local variable <em>name</em> to the element being processed, and the local variable <em>enum name</em> to the enumeration index (if set).</p>
<p>The Shell shall cancel the for loop if two consecutive commands are interrupted via SIGINT (^C), and any other terminating signal aborts the loop entirely.</p>
<h6 id="examples-3"><a style="margin-right: 15px" href="#examples-3">#</a>Examples</h6>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over every non-hidden file in the current directory, and prepend &#39;1-&#39; to its name.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> for <span class="pp">*</span> { mv <span class="va">$it</span> 1-<span class="va">$it</span> }</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over a sequence and write each element to a file</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> for i in <span class="va">$(</span><span class="fu">seq</span> 1 100<span class="va">)</span> { echo <span class="va">$i</span> <span class="op">&gt;&gt;</span> foo }</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over some files and get their index</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> for index i x in <span class="pp">*</span> { echo file at index <span class="va">$i</span> is named <span class="va">$x</span> }</span></code></pre></div>
<h5 id="infinite-loops"><a style="margin-right: 15px" href="#infinite-loops">#</a>Infinite Loops</h5>
<p>Infinite loops (as denoted by the keyword <code>loop</code>) can be used to repeat a block until the block runs <code>break</code>, or the loop terminates by external sources (interrupts, program exit, and terminating signals).</p>
<p>The behavior regarding SIGINT and other signals is the same as for loops (mentioned above).</p>
<h6 id="examples-4"><a style="margin-right: 15px" href="#examples-4">#</a>Examples</h6>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep deleting a file</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">loop</span> {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="at">-f</span> foo</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<h5 id="subshells"><a style="margin-right: 15px" href="#subshells">#</a>Subshells</h5>
<p>Subshells evaluate a given block in a new instance (fork) of the current shell process. to create a subshell, any valid shell code can be enclosed in braces.</p>
<h6 id="examples-5"><a style="margin-right: 15px" href="#examples-5">#</a>Examples</h6>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run a block of code in the background, in a subshell, then detach it from the current shell</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> { for <span class="pp">*</span> { te <span class="va">$it</span> } }<span class="kw">&amp;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> disown</span></code></pre></div>
<h5 id="functions"><a style="margin-right: 15px" href="#functions">#</a>Functions</h5>
<p>A function is a user-defined entity that can be used as a simple command to execute a compound command, optionally with some parameters. Such a function is defined via the syntax below:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">function_name</span><span class="er">(</span><span class="ex">explicitly_named_arguments...</span><span class="kw">)</span> <span class="kw">{</span> <span class="ex">compound_command</span> }</span></code></pre></div>
<p>The function is named <code>function_name</code>, and has some explicitly named arguments <code>explicitly_named_arguments...</code>, which <em>must</em> be supplied by the caller, failure to do so will cause the command to exit with status 1.</p>
<p>The compound command shall be executed whenever the simple command <code>function_name</code> is executed. This execution shall be performed in a new local frame.</p>
<p>Additionally, should the simple command containing the function name be in a pipeline, or requested to be run in the background, this execution shall be moved to a subshell; naturally, in such a case any changes to the shell state (such as variables, aliases, etc) shall not be leaked to the parent shell process.</p>
<p>The passed arguments shall be stored in the special variables <code>*</code> and <code>ARGV</code>, and the explicitly named arguments shall be set, in order, from the first passed argument onwards.</p>
<p>The exit status of a function simple command shall be the exit status of the last command executed within the command, or 0 if the function has no commands. The declaration is <em>not</em> a command, and will not alter the exit status.</p>
<h6 id="examples-6"><a style="margin-right: 15px" href="#examples-6">#</a>Examples</h6>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">fn</span><span class="er">(</span><span class="ex">a</span> b c<span class="kw">)</span> <span class="kw">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="va">$a</span> <span class="va">$b</span> <span class="va">$c</span> <span class="dt">\(</span> <span class="va">$*</span> <span class="dt">\)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> fn 1 2 3 4</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 2 3 ( 1 2 3 4 )</span></span></code></pre></div>
<h5 id="match-expressions"><a style="margin-right: 15px" href="#match-expressions">#</a>Match Expressions</h5>
<p>The pattern matching construct <code>match</code> shall choose from a sequence of patterns, and execute the corresponding action in a new frame. The choice is done by matching the result of the <em>matched expression</em> (after expansion) against the <em>patterns</em> (expanded down to either globs or literals). Multiple <em>patterns</em> can be attributed to a single given action by delimiting them with a pipe ('|') symbol. A <em>pattern</em> (or the series of) may be annotated with an extra <code>as (...)</code> clause, which allows globbed parts of the matching pattern to be named and used in the matching block.</p>
<p>The expanded <em>matched expression</em> can optionally be given a name using the <code>as name</code> clause after the <em>matched expression</em>, with which it may be accessible in the action clauses.</p>
<h6 id="examples-7"><a style="margin-right: 15px" href="#examples-7">#</a>Examples</h6>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Match the result of running &#39;make_some_value&#39; (which is a list when captured by $(...))</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">match</span> <span class="st">&quot;</span><span class="va">$(</span><span class="ex">make_some_value</span><span class="va">)</span><span class="st">&quot;</span> as value {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">(</span><span class="ex">hello*</span><span class="kw">)</span> <span class="kw">{</span> <span class="bu">echo</span> <span class="st">&quot;Hi!&quot;</span> }</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">(</span><span class="ex">say\ *</span><span class="kw">)</span> <span class="kw">{</span> <span class="bu">echo</span> <span class="st">&quot;No, I will not </span><span class="va">$value</span><span class="st">&quot;</span> }</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Match the result of running &#39;make_some_value&#39;, cast to a string</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the `as (expr)` in the second pattern, which assigns whatever the `*` matches</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># to the name `expr` inside the block.</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="ex">match</span> <span class="st">&quot;</span><span class="va">$(</span><span class="ex">make_some_value</span><span class="va">)</span><span class="st">&quot;</span> {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">hello*</span> { echo <span class="st">&quot;Hi!&quot;</span> }</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">say\ *</span> as <span class="er">(</span><span class="fu">expr</span><span class="kw">)</span> <span class="kw">{</span> <span class="bu">echo</span> <span class="st">&quot;No, I will not say </span><span class="va">$expr</span><span class="st">!&quot;</span> }</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 id="history-event-designators"><a style="margin-right: 15px" href="#history-event-designators">#</a>History Event Designators</h3>
<p>History expansion may be utilized to reuse previously typed words or commands. Such expressions are of the general form <code>!&lt;event_designator&gt;(:&lt;word_designator&gt;)</code>, where <code>event_designator</code> would select an entry in the shell history, and <code>word_designator</code> would select a word (or a range of words) from that entry.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Event designator</th>
<th style="text-align: left;">Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>!</code></td>
<td style="text-align: left;">The immediately preceding command</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>n</em></td>
<td style="text-align: left;">The <em>n</em>'th entry in the history, starting with 1 as the first entry</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-<em>n</em></td>
<td style="text-align: left;">The last <em>n</em>'th entry in the history, starting with -1 as the previous entry</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>str</em></td>
<td style="text-align: left;">The most recent entry starting with <em>str</em></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>?</code><em>str</em></td>
<td style="text-align: left;">The most recent entry containing <em>str</em></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Word designator</th>
<th style="text-align: left;">Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><em>n</em></td>
<td style="text-align: left;">The word at index <em>n</em>, starting with 0 as the first word (usually the command)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>^</code></td>
<td style="text-align: left;">The first argument (index 1)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>$</code></td>
<td style="text-align: left;">The last argument</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>x</em>-<em>y</em></td>
<td style="text-align: left;">The range of words starting at <em>x</em> and ending at <em>y</em> (inclusive). <em>x</em> defaults to 0 if omitted</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>*</code></td>
<td style="text-align: left;">All the arguments. Equivalent to <code>^</code>-<code>$</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>x</em><code>*</code></td>
<td style="text-align: left;">The range of words starting at <em>x</em> and ending at the last word (<code>$</code>) (inclusive)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>x</em>-</td>
<td style="text-align: left;">The range of words starting at <em>x</em> and ending at the second to last word (inclusive). <em>x</em> defaults to 0 if omitted</td>
</tr>
</tbody>
</table>
<p>Note: The event designator and the word designator should usually be separated by a colon (<code>:</code>). This colon can be omitted only if the word designator starts with <code>^</code>, <code>$</code> or <code>*</code> (such as <code>!1^</code> for the first argument of the first entry in the history).</p>
<h2 id="formal-grammar"><a style="margin-right: 15px" href="#formal-grammar">#</a>Formal Grammar</h2>
<h3 id="shell-grammar"><a style="margin-right: 15px" href="#shell-grammar">#</a>Shell Grammar</h3>
<pre><code>toplevel :: sequence?

sequence :: variable_decls? or_logical_sequence terminator sequence
          | variable_decls? or_logical_sequence &#39;&amp;&#39; sequence
          | variable_decls? or_logical_sequence
          | variable_decls? function_decl (terminator sequence)?
          | variable_decls? terminator sequence

function_decl :: identifier &#39;(&#39; (ws* identifier)* &#39;)&#39; ws* &#39;{&#39; [!c] toplevel &#39;}&#39;

or_logical_sequence :: and_logical_sequence &#39;|&#39; &#39;|&#39; and_logical_sequence
                     | and_logical_sequence

and_logical_sequence :: pipe_sequence &#39;&amp;&#39; &#39;&amp;&#39; and_logical_sequence
                      | pipe_sequence

terminator :: &#39;;&#39;
            | &#39;\n&#39; [?!heredoc_stack.is_empty] heredoc_entries

heredoc_entries :: { .*? (heredoc_entry) &#39;\n&#39; } [each heredoc_entries]

variable_decls :: identifier &#39;=&#39; expression (&#39; &#39;+ variable_decls)? &#39; &#39;*
                | identifier &#39;=&#39; &#39;(&#39; pipe_sequence &#39;)&#39; (&#39; &#39;+ variable_decls)? &#39; &#39;*

pipe_sequence :: command &#39;|&#39; pipe_sequence
               | command
               | control_structure &#39;|&#39; pipe_sequence
               | control_structure

control_structure[c] :: for_expr
                      | loop_expr
                      | if_expr
                      | subshell
                      | match_expr
                      | ?c: continuation_control

continuation_control :: &#39;break&#39;
                      | &#39;continue&#39;

for_expr :: &#39;for&#39; ws+ ((&#39;index&#39; &#39; &#39;+ identifier &#39; &#39;+)? identifier &#39; &#39;+ &#39;in&#39; ws*)? expression ws+ &#39;{&#39; [c] toplevel &#39;}&#39;

loop_expr :: &#39;loop&#39; ws* &#39;{&#39; [c] toplevel &#39;}&#39;

if_expr :: &#39;if&#39; ws+ or_logical_sequence ws+ &#39;{&#39; toplevel &#39;}&#39; else_clause?

else_clause :: else &#39;{&#39; toplevel &#39;}&#39;
             | else if_expr

subshell :: &#39;{&#39; toplevel &#39;}&#39;

match_expr :: &#39;match&#39; ws+ expression ws* (&#39;as&#39; ws+ identifier)? &#39;{&#39; match_entry* &#39;}&#39;

match_entry :: match_pattern ws* (as identifier_list)? &#39;{&#39; toplevel &#39;}&#39;

identifier_list :: &#39;(&#39; (identifier ws*)* &#39;)&#39;

match_pattern :: expression (ws* &#39;|&#39; ws* expression)*

command :: redirection command
         | list_expression command?

redirection :: number? &#39;&gt;&#39;{1,2} &#39; &#39;* string_composite
             | number? &#39;&lt;&#39; &#39; &#39;* string_composite
             | number? &#39;&gt;&#39; &#39;&amp;&#39; number
             | number? &#39;&gt;&#39; &#39;&amp;&#39; &#39;-&#39;

list_expression :: &#39; &#39;* expression (&#39; &#39;+ list_expression)?

expression :: evaluate expression?
            | string_composite expression?
            | comment expression?
            | immediate_expression expression?
            | history_designator expression?
            | &#39;(&#39; list_expression &#39;)&#39; expression?

evaluate :: &#39;$&#39; &#39;(&#39; pipe_sequence &#39;)&#39;
          | &#39;$&#39; expression          {eval / dynamic resolve}

string_composite :: string string_composite?
                  | variable string_composite?
                  | bareword string_composite?
                  | glob string_composite?
                  | brace_expansion string_composite?
                  | heredoc_initiator string_composite?    {append to heredoc_entries}

heredoc_initiator :: &#39;&lt;&#39; &#39;&lt;&#39; &#39;-&#39; bareword         {*bareword, interpolate, no deindent}
                   | &#39;&lt;&#39; &#39;&lt;&#39; &#39;-&#39; &quot;&#39;&quot; [^&#39;]* &quot;&#39;&quot;    {*string, no interpolate, no deindent}
                   | &#39;&lt;&#39; &#39;&lt;&#39; &#39;~&#39; bareword         {*bareword, interpolate, deindent}
                   | &#39;&lt;&#39; &#39;&lt;&#39; &#39;~&#39; &quot;&#39;&quot; [^&#39;]* &quot;&#39;&quot;    {*bareword, no interpolate, deindent}

string :: &#39;&quot;&#39; dquoted_string_inner &#39;&quot;&#39;
        | &quot;&#39;&quot; [^&#39;]* &quot;&#39;&quot;

dquoted_string_inner :: &#39;\&#39; . dquoted_string_inner?       {concat}
                      | variable dquoted_string_inner?    {compose}
                      | . dquoted_string_inner?
                      | &#39;\&#39; &#39;x&#39; xdigit*2 dquoted_string_inner?
                      | &#39;\&#39; &#39;u&#39; xdigit*8 dquoted_string_inner?
                      | &#39;\&#39; [abefrnt] dquoted_string_inner?

variable :: variable_ref slice?

variable_ref :: &#39;$&#39; identifier
          | &#39;$&#39; &#39;$&#39;
          | &#39;$&#39; &#39;?&#39;
          | &#39;$&#39; &#39;*&#39;
          | &#39;$&#39; &#39;#&#39;
          | ...

slice :: &#39;[&#39; brace_expansion_spec &#39;]&#39;

comment :: (?&lt;!\w) &#39;#&#39; .*

immediate_expression :: &#39;$&#39; &#39;{&#39; immediate_function expression* &#39;}&#39;

immediate_function :: identifier       { predetermined list of names, see Shell.h:ENUMERATE_SHELL_IMMEDIATE_FUNCTIONS }

history_designator :: &#39;!&#39; event_selector (&#39;:&#39; word_selector_composite)?

event_selector :: &#39;!&#39;                  {== &#39;-0&#39;}
                | &#39;?&#39; bareword &#39;?&#39;
                | bareword             {number: index, otherwise: lookup}

word_selector_composite :: word_selector (&#39;-&#39; word_selector)?

word_selector :: number
               | &#39;^&#39;                   {== 0}
               | &#39;$&#39;                   {== end}

bareword :: [^&quot;&#39;*$&amp;|()[\]{} ?;&lt;&gt;] bareword?
          | &#39;\&#39; [^&quot;&#39;*$&amp;|()[\]{} ?;&lt;&gt;] bareword?

bareword_with_tilde_expansion :: &#39;~&#39; bareword?

glob :: [*?] bareword?
      | bareword [*?]

brace_expansion :: &#39;{&#39; brace_expansion_spec &#39;}&#39;

brace_expansion_spec :: expression? (&#39;,&#39; expression?)*
                      | expression &#39;..&#39; expression

digit :: &lt;native hex digit&gt;
number :: &lt;number in base 10&gt;
identifier :: &lt;string of word characters&gt;</code></pre>
</body>
</html>
